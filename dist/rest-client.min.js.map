{
  "version": 3,
  "sources": ["../node_modules/minivents/dist/minivents.commonjs.min.js", "../src/rest-client.js"],
  "sourcesContent": ["module.exports=function(n){var t={},e=[];n=n||this,n.on=function(e,r,l){return(t[e]=t[e]||[]).push([r,l]),n},n.off=function(r,l){r||(t={});for(var o=t[r]||e,u=o.length=l?o.length:0;u--;)l==o[u][0]&&o.splice(u,1);return n},n.emit=function(r){for(var l,o=t[r]||e,u=o.length>0?o.slice(0,o.length):o,i=0;l=u[i++];)l[0].apply(l[1],e.slice.call(arguments,1));return n}};", "import Events from 'minivents'\n\nfunction encodeUrl(data) {\n    let res = '';\n    for (let k in data)\n        res += encodeURIComponent(k) + '=' + encodeURIComponent(data[k]) + '&';\n    return res.substr(0, res.length - 1);\n}\n\nfunction safe(func, data) {\n    try {\n        return func(data);\n    }\n    catch(e) {\n        console.error('Error in function \"' + func.name + '\" while decode/encode data');\n        console.log(func);\n        console.log(data);\n        console.log(e);\n        return data;\n    }\n}\n\nclass RestClient {\n    constructor(host, options) {\n        this.host = host;\n        this.conf(options);\n\n        new Events(this);\n\n        // resource must be super class of RestClient\n        // but fucking js cannot into callable objects, so...\n        // After this call all resource methods will be defined\n        // on current RestClient instance (this behaviour affected by last parameter)\n        // At least this parameters are symmetric :D\n        resource(this, undefined, '', undefined, this);\n    }\n\n    conf(options={}) {\n        let currentOptions = this._opts || {\n            trailing: '',\n            shortcut: true,\n            shortcutRules: [],\n            contentType: 'application/json',\n            'application/x-www-form-urlencoded': {encode: encodeUrl},\n            'application/json': {encode: JSON.stringify, decode: JSON.parse}\n        };\n\n        this._opts = Object.assign(currentOptions, options);\n\n        return Object.assign({}, this._opts);\n    }\n\n    _request(method, url, data=null, contentType=null) {\n        if (url.indexOf('?') === -1)\n            url += this._opts.trailing;\n        else\n            url = url.replace('?', this._opts.trailing + '?');\n\n        let xhr = new XMLHttpRequest();\n        xhr.open(method, this.host + url, true);\n\n        if (contentType) {\n            let mime = this._opts[contentType];\n            if (mime && mime.encode)\n                data = safe(mime.encode, data);\n            if (!(contentType === 'multipart/form-data' && data.constructor.name === 'FormData'))\n                xhr.setRequestHeader('Content-Type', contentType);\n        }\n\n        let p = new Promise((resolve, reject) =>\n            xhr.onreadystatechange = () => {\n                if (xhr.readyState === 4) {\n                    this.emit('response', xhr);\n                    p.emit('response', xhr);\n                    if (xhr.status === 200 || xhr.status === 201 || xhr.status === 204) {\n                        this.emit('success', xhr);\n                        p.emit('success', xhr);\n\n                        let res = xhr.response;\n                        let responseHeader = xhr.getResponseHeader('Content-Type');\n                        if (responseHeader) {\n                            let responseContentType = responseHeader.split(';')[0];\n                            let mime = this._opts[responseContentType];\n                            if (mime && mime.decode)\n                                res = safe(mime.decode, res);\n                        }\n                        p.off();\n                        resolve(res);\n                    } else {\n                        this.emit('error', xhr);\n                        p.emit('error', xhr);\n                        p.off();\n                        reject(xhr);\n                    }\n                }\n            }\n        );\n        new Events(p);\n        Promise.resolve().then(() => {\n            this.emit('request', xhr);\n            p.emit('request', xhr);\n            xhr.send(data);\n        });\n        return p;\n    }\n}\n\nfunction resource(client, parent, name, id, ctx) {\n    let self = ctx ? ctx : (newId) => {\n        if (newId === undefined)\n            return self;\n        return self._clone(parent, newId);\n    };\n\n    self._resources = {};\n    self._shortcuts = {};\n\n    self._clone = (parent, newId) => {\n        let copy = resource(client, parent, name, newId);\n        copy._shortcuts = self._shortcuts;\n        for (let resName in self._resources) {\n            copy._resources[resName] = self._resources[resName]._clone(copy);\n\n            if (resName in copy._shortcuts)\n                copy[resName] = copy._resources[resName];\n        }\n        return copy;\n    };\n\n    self.res = (resources, shortcut=client._opts.shortcut) => {\n        let makeRes = (resName) => {\n            if (resName in self._resources)\n                return self._resources[resName];\n\n            let r = resource(client, self, resName);\n            self._resources[resName] = r;\n            if (shortcut) {\n                self._shortcuts[resName] = r;\n                self[resName] = r;\n                client._opts.shortcutRules.forEach(rule => {\n                    let customShortcut = rule(resName);\n                    if (customShortcut && typeof customShortcut === 'string') {\n                        self._shortcuts[customShortcut] = r;\n                        self[customShortcut] = r;\n                    }\n                });\n            }\n            return r;\n        };\n\n        // (resources instanceof String) don't work. Fuck you, javascript.\n        if (resources.constructor === String)\n            return makeRes(resources);\n\n        if (resources instanceof Array)\n            return resources.map(makeRes);\n\n        if (resources instanceof Object) {\n            let res = {};\n            for (let resName in resources) {\n                let r = makeRes(resName);\n                if (resources[resName])\n                    r.res(resources[resName]);\n                res[resName] = r;\n            }\n            return res;\n        }\n    };\n\n    self.url = () => {\n        let url = parent ? parent.url() : '';\n        if (name)\n            url += '/' + name;\n        if (id !== undefined)\n            url += '/' + id;\n        return url;\n    };\n\n    self.get = (...args) => {\n        let url = self.url();\n        const query = args.map(encodeUrl).join('&')\n        if (query)\n            url += '?' + query;\n        return client._request('GET', url);\n    };\n\n    self.post = (data, contentType = client._opts.contentType) => {\n        return client._request('POST', self.url(), data, contentType);\n    };\n\n    self.put = (data, contentType = client._opts.contentType) => {\n        return client._request('PUT', self.url(), data, contentType);\n    };\n\n    self.patch = (data, contentType = client._opts.contentType) => {\n        return client._request('PATCH', self.url(), data, contentType);\n    };\n\n    self.delete = () => {\n        return client._request('DELETE', self.url());\n    };\n    return self;\n}\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nmodule.exports = RestClient;\n"],
  "mappings": "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",
  "names": []
}
