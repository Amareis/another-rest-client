{
  "version": 3,
  "sources": ["../node_modules/minivents/dist/minivents.commonjs.min.js", "../src/rest-client.js"],
  "sourcesContent": ["module.exports=function(n){var t={},e=[];n=n||this,n.on=function(e,r,l){return(t[e]=t[e]||[]).push([r,l]),n},n.off=function(r,l){r||(t={});for(var o=t[r]||e,u=o.length=l?o.length:0;u--;)l==o[u][0]&&o.splice(u,1);return n},n.emit=function(r){for(var l,o=t[r]||e,u=o.length>0?o.slice(0,o.length):o,i=0;l=u[i++];)l[0].apply(l[1],e.slice.call(arguments,1));return n}};", "import Events from 'minivents'\n\nfunction encodeUrl(data) {\n    let res = '';\n    for (let k in data)\n        res += encodeURIComponent(k) + '=' + encodeURIComponent(data[k]) + '&';\n    return res.substr(0, res.length - 1);\n}\n\nfunction safe(func, data) {\n    try {\n        return func(data);\n    }\n    catch(e) {\n        console.error('Error in function \"' + func.name + '\" while decode/encode data');\n        console.log(func);\n        console.log(data);\n        console.log(e);\n        return data;\n    }\n}\n\nclass RestClient {\n    constructor(host, options) {\n        this.host = host;\n        this.conf(options);\n\n        new Events(this);\n\n        // resource must be super class of RestClient\n        // but fucking js cannot into callable objects, so...\n        // After this call all resource methods will be defined\n        // on current RestClient instance (this behaviour affected by last parameter)\n        // At least this parameters are symmetric :D\n        resource(this, undefined, '', undefined, this);\n    }\n\n    conf(options={}) {\n        let currentOptions = this._opts || {\n            trailing: '',\n            shortcut: true,\n            shortcutRules: [],\n            contentType: 'application/json',\n            'application/x-www-form-urlencoded': {encode: encodeUrl},\n            'application/json': {encode: JSON.stringify, decode: JSON.parse}\n        };\n\n        this._opts = Object.assign(currentOptions, options);\n\n        return Object.assign({}, this._opts);\n    }\n\n    _request(method, url, data=null, contentType=null) {\n        if (url.indexOf('?') === -1)\n            url += this._opts.trailing;\n        else\n            url = url.replace('?', this._opts.trailing + '?');\n\n        let xhr = new XMLHttpRequest();\n        xhr.open(method, this.host + url, true);\n\n        if (contentType) {\n            let mime = this._opts[contentType];\n            if (mime && mime.encode)\n                data = safe(mime.encode, data);\n            if (!(contentType === 'multipart/form-data' && data.constructor.name === 'FormData'))\n                xhr.setRequestHeader('Content-Type', contentType);\n        }\n\n        let p = new Promise((resolve, reject) =>\n            xhr.onreadystatechange = () => {\n                if (xhr.readyState === 4) {\n                    this.emit('response', xhr);\n                    p.emit('response', xhr);\n                    if (xhr.status === 200 || xhr.status === 201 || xhr.status === 204) {\n                        this.emit('success', xhr);\n                        p.emit('success', xhr);\n\n                        let res = xhr.response;\n                        let responseHeader = xhr.getResponseHeader('Content-Type');\n                        if (responseHeader) {\n                            let responseContentType = responseHeader.split(';')[0];\n                            let mime = this._opts[responseContentType];\n                            if (mime && mime.decode)\n                                res = safe(mime.decode, res);\n                        }\n                        p.off();\n                        resolve(res);\n                    } else {\n                        this.emit('error', xhr);\n                        p.emit('error', xhr);\n                        p.off();\n                        reject(xhr);\n                    }\n                }\n            }\n        );\n        new Events(p);\n        Promise.resolve().then(() => {\n            this.emit('request', xhr);\n            p.emit('request', xhr);\n            xhr.send(data);\n        });\n        return p;\n    }\n}\n\nfunction resource(client, parent, name, id, ctx) {\n    let self = ctx ? ctx : (newId) => {\n        if (newId === undefined)\n            return self;\n        return self._clone(parent, newId);\n    };\n\n    self._resources = {};\n    self._shortcuts = {};\n\n    self._clone = (parent, newId) => {\n        let copy = resource(client, parent, name, newId);\n        copy._shortcuts = self._shortcuts;\n        for (let resName in self._resources) {\n            copy._resources[resName] = self._resources[resName]._clone(copy);\n\n            if (resName in copy._shortcuts)\n                copy[resName] = copy._resources[resName];\n        }\n        return copy;\n    };\n\n    self.res = (resources, shortcut=client._opts.shortcut) => {\n        let makeRes = (resName) => {\n            if (resName in self._resources)\n                return self._resources[resName];\n\n            let r = resource(client, self, resName);\n            self._resources[resName] = r;\n            if (shortcut) {\n                self._shortcuts[resName] = r;\n                self[resName] = r;\n                client._opts.shortcutRules.forEach(rule => {\n                    let customShortcut = rule(resName);\n                    if (customShortcut && typeof customShortcut === 'string') {\n                        self._shortcuts[customShortcut] = r;\n                        self[customShortcut] = r;\n                    }\n                });\n            }\n            return r;\n        };\n\n        // (resources instanceof String) don't work. Fuck you, javascript.\n        if (resources.constructor === String)\n            return makeRes(resources);\n\n        if (resources instanceof Array)\n            return resources.map(makeRes);\n\n        if (resources instanceof Object) {\n            let res = {};\n            for (let resName in resources) {\n                let r = makeRes(resName);\n                if (resources[resName])\n                    r.res(resources[resName]);\n                res[resName] = r;\n            }\n            return res;\n        }\n    };\n\n    self.url = () => {\n        let url = parent ? parent.url() : '';\n        if (name)\n            url += '/' + name;\n        if (id !== undefined)\n            url += '/' + id;\n        return url;\n    };\n\n    self.get = (...args) => {\n        let url = self.url();\n        const query = args.map(encodeUrl).join('&')\n        if (query)\n            url += '?' + query;\n        return client._request('GET', url);\n    };\n\n    self.post = (data, contentType = client._opts.contentType) => {\n        return client._request('POST', self.url(), data, contentType);\n    };\n\n    self.put = (data, contentType = client._opts.contentType) => {\n        return client._request('PUT', self.url(), data, contentType);\n    };\n\n    self.patch = (data, contentType = client._opts.contentType) => {\n        return client._request('PATCH', self.url(), data, contentType);\n    };\n\n    self.delete = () => {\n        return client._request('DELETE', self.url());\n    };\n    return self;\n}\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nmodule.exports = RestClient;\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA,aAAO,UAAQ,SAAS,GAAE;AAAC,YAAI,IAAE,CAAC,GAAE,IAAE,CAAC;AAAE,YAAE,KAAG,MAAK,EAAE,KAAG,SAAS,IAAE,GAAE,GAAE;AAAC,iBAAO,GAAE,MAAG,EAAE,OAAI,CAAC,GAAG,KAAK,CAAC,GAAE,CAAC,CAAC,GAAE;AAAA,QAAC,GAAE,EAAE,MAAI,SAAS,GAAE,GAAE;AAAC,eAAI,KAAE,CAAC;AAAG,mBAAQ,IAAE,EAAE,MAAI,GAAE,IAAE,EAAE,SAAO,IAAE,EAAE,SAAO,GAAE;AAAK,iBAAG,EAAE,GAAG,MAAI,EAAE,OAAO,GAAE,CAAC;AAAE,iBAAO;AAAA,QAAC,GAAE,EAAE,OAAK,SAAS,GAAE;AAAC,mBAAQ,GAAE,IAAE,EAAE,MAAI,GAAE,IAAE,EAAE,SAAO,IAAE,EAAE,MAAM,GAAE,EAAE,MAAM,IAAE,GAAE,IAAE,GAAE,IAAE,EAAE;AAAM,cAAE,GAAG,MAAM,EAAE,IAAG,EAAE,MAAM,KAAK,WAAU,CAAC,CAAC;AAAE,iBAAO;AAAA,QAAC;AAAA,MAAC;AAAA;AAAA;;;ACA1W;AAAA;AAAA,6BAAmB;AAEnB,yBAAmB,MAAM;AACrB,YAAI,MAAM;AACV,iBAAS,KAAK;AACV,iBAAO,mBAAmB,CAAC,IAAI,MAAM,mBAAmB,KAAK,EAAE,IAAI;AACvE,eAAO,IAAI,OAAO,GAAG,IAAI,SAAS,CAAC;AAAA,MACvC;AAEA,oBAAc,MAAM,MAAM;AACtB,YAAI;AACA,iBAAO,KAAK,IAAI;AAAA,QACpB,SACM,GAAN;AACI,kBAAQ,MAAM,wBAAwB,KAAK,OAAO,4BAA4B;AAC9E,kBAAQ,IAAI,IAAI;AAChB,kBAAQ,IAAI,IAAI;AAChB,kBAAQ,IAAI,CAAC;AACb,iBAAO;AAAA,QACX;AAAA,MACJ;AAEA,6BAAiB;AAAA,QACb,YAAY,MAAM,SAAS;AACvB,eAAK,OAAO;AACZ,eAAK,KAAK,OAAO;AAEjB,cAAI,yBAAO,IAAI;AAOf,mBAAS,MAAM,QAAW,IAAI,QAAW,IAAI;AAAA,QACjD;AAAA,QAEA,KAAK,UAAQ,CAAC,GAAG;AACb,cAAI,iBAAiB,KAAK,SAAS;AAAA,YAC/B,UAAU;AAAA,YACV,UAAU;AAAA,YACV,eAAe,CAAC;AAAA,YAChB,aAAa;AAAA,YACb,qCAAqC,EAAC,QAAQ,UAAS;AAAA,YACvD,oBAAoB,EAAC,QAAQ,KAAK,WAAW,QAAQ,KAAK,MAAK;AAAA,UACnE;AAEA,eAAK,QAAQ,OAAO,OAAO,gBAAgB,OAAO;AAElD,iBAAO,OAAO,OAAO,CAAC,GAAG,KAAK,KAAK;AAAA,QACvC;AAAA,QAEA,SAAS,QAAQ,KAAK,OAAK,MAAM,cAAY,MAAM;AAC/C,cAAI,IAAI,QAAQ,GAAG,MAAM;AACrB,mBAAO,KAAK,MAAM;AAAA;AAElB,kBAAM,IAAI,QAAQ,KAAK,KAAK,MAAM,WAAW,GAAG;AAEpD,cAAI,MAAM,IAAI,eAAe;AAC7B,cAAI,KAAK,QAAQ,KAAK,OAAO,KAAK,IAAI;AAEtC,cAAI,aAAa;AACb,gBAAI,OAAO,KAAK,MAAM;AACtB,gBAAI,QAAQ,KAAK;AACb,qBAAO,KAAK,KAAK,QAAQ,IAAI;AACjC,gBAAI,CAAE,iBAAgB,yBAAyB,KAAK,YAAY,SAAS;AACrE,kBAAI,iBAAiB,gBAAgB,WAAW;AAAA,UACxD;AAEA,cAAI,IAAI,IAAI,QAAQ,CAAC,SAAS,WAC1B,IAAI,qBAAqB,MAAM;AAC3B,gBAAI,IAAI,eAAe,GAAG;AACtB,mBAAK,KAAK,YAAY,GAAG;AACzB,gBAAE,KAAK,YAAY,GAAG;AACtB,kBAAI,IAAI,WAAW,OAAO,IAAI,WAAW,OAAO,IAAI,WAAW,KAAK;AAChE,qBAAK,KAAK,WAAW,GAAG;AACxB,kBAAE,KAAK,WAAW,GAAG;AAErB,oBAAI,MAAM,IAAI;AACd,oBAAI,iBAAiB,IAAI,kBAAkB,cAAc;AACzD,oBAAI,gBAAgB;AAChB,sBAAI,sBAAsB,eAAe,MAAM,GAAG,EAAE;AACpD,sBAAI,OAAO,KAAK,MAAM;AACtB,sBAAI,QAAQ,KAAK;AACb,0BAAM,KAAK,KAAK,QAAQ,GAAG;AAAA,gBACnC;AACA,kBAAE,IAAI;AACN,wBAAQ,GAAG;AAAA,cACf,OAAO;AACH,qBAAK,KAAK,SAAS,GAAG;AACtB,kBAAE,KAAK,SAAS,GAAG;AACnB,kBAAE,IAAI;AACN,uBAAO,GAAG;AAAA,cACd;AAAA,YACJ;AAAA,UACJ,CACJ;AACA,cAAI,yBAAO,CAAC;AACZ,kBAAQ,QAAQ,EAAE,KAAK,MAAM;AACzB,iBAAK,KAAK,WAAW,GAAG;AACxB,cAAE,KAAK,WAAW,GAAG;AACrB,gBAAI,KAAK,IAAI;AAAA,UACjB,CAAC;AACD,iBAAO;AAAA,QACX;AAAA,MACJ;AAEA,wBAAkB,QAAQ,QAAQ,MAAM,IAAI,KAAK;AAC7C,YAAI,OAAO,MAAM,MAAM,CAAC,UAAU;AAC9B,cAAI,UAAU;AACV,mBAAO;AACX,iBAAO,KAAK,OAAO,QAAQ,KAAK;AAAA,QACpC;AAEA,aAAK,aAAa,CAAC;AACnB,aAAK,aAAa,CAAC;AAEnB,aAAK,SAAS,CAAC,SAAQ,UAAU;AAC7B,cAAI,OAAO,SAAS,QAAQ,SAAQ,MAAM,KAAK;AAC/C,eAAK,aAAa,KAAK;AACvB,mBAAS,WAAW,KAAK,YAAY;AACjC,iBAAK,WAAW,WAAW,KAAK,WAAW,SAAS,OAAO,IAAI;AAE/D,gBAAI,WAAW,KAAK;AAChB,mBAAK,WAAW,KAAK,WAAW;AAAA,UACxC;AACA,iBAAO;AAAA,QACX;AAEA,aAAK,MAAM,CAAC,WAAW,WAAS,OAAO,MAAM,aAAa;AACtD,cAAI,UAAU,CAAC,YAAY;AACvB,gBAAI,WAAW,KAAK;AAChB,qBAAO,KAAK,WAAW;AAE3B,gBAAI,IAAI,SAAS,QAAQ,MAAM,OAAO;AACtC,iBAAK,WAAW,WAAW;AAC3B,gBAAI,UAAU;AACV,mBAAK,WAAW,WAAW;AAC3B,mBAAK,WAAW;AAChB,qBAAO,MAAM,cAAc,QAAQ,UAAQ;AACvC,oBAAI,iBAAiB,KAAK,OAAO;AACjC,oBAAI,kBAAkB,OAAO,mBAAmB,UAAU;AACtD,uBAAK,WAAW,kBAAkB;AAClC,uBAAK,kBAAkB;AAAA,gBAC3B;AAAA,cACJ,CAAC;AAAA,YACL;AACA,mBAAO;AAAA,UACX;AAGA,cAAI,UAAU,gBAAgB;AAC1B,mBAAO,QAAQ,SAAS;AAE5B,cAAI,qBAAqB;AACrB,mBAAO,UAAU,IAAI,OAAO;AAEhC,cAAI,qBAAqB,QAAQ;AAC7B,gBAAI,MAAM,CAAC;AACX,qBAAS,WAAW,WAAW;AAC3B,kBAAI,IAAI,QAAQ,OAAO;AACvB,kBAAI,UAAU;AACV,kBAAE,IAAI,UAAU,QAAQ;AAC5B,kBAAI,WAAW;AAAA,YACnB;AACA,mBAAO;AAAA,UACX;AAAA,QACJ;AAEA,aAAK,MAAM,MAAM;AACb,cAAI,MAAM,SAAS,OAAO,IAAI,IAAI;AAClC,cAAI;AACA,mBAAO,MAAM;AACjB,cAAI,OAAO;AACP,mBAAO,MAAM;AACjB,iBAAO;AAAA,QACX;AAEA,aAAK,MAAM,IAAI,SAAS;AACpB,cAAI,MAAM,KAAK,IAAI;AACnB,gBAAM,QAAQ,KAAK,IAAI,SAAS,EAAE,KAAK,GAAG;AAC1C,cAAI;AACA,mBAAO,MAAM;AACjB,iBAAO,OAAO,SAAS,OAAO,GAAG;AAAA,QACrC;AAEA,aAAK,OAAO,CAAC,MAAM,cAAc,OAAO,MAAM,gBAAgB;AAC1D,iBAAO,OAAO,SAAS,QAAQ,KAAK,IAAI,GAAG,MAAM,WAAW;AAAA,QAChE;AAEA,aAAK,MAAM,CAAC,MAAM,cAAc,OAAO,MAAM,gBAAgB;AACzD,iBAAO,OAAO,SAAS,OAAO,KAAK,IAAI,GAAG,MAAM,WAAW;AAAA,QAC/D;AAEA,aAAK,QAAQ,CAAC,MAAM,cAAc,OAAO,MAAM,gBAAgB;AAC3D,iBAAO,OAAO,SAAS,SAAS,KAAK,IAAI,GAAG,MAAM,WAAW;AAAA,QACjE;AAEA,aAAK,SAAS,MAAM;AAChB,iBAAO,OAAO,SAAS,UAAU,KAAK,IAAI,CAAC;AAAA,QAC/C;AACA,eAAO;AAAA,MACX;AAEA,aAAO,eAAe,SAAS,cAAc;AAAA,QAC3C,OAAO;AAAA,MACT,CAAC;AAED,aAAO,UAAU;AAAA;AAAA;",
  "names": []
}
